@model IEnumerable<EvergreenAPI.Models.Account>
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Manage Blocked";
}

<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h4 class="m-0 font-weight-bold text-primary">User Status Managements</h4>
        <div class="d-flex justify-content-between align-items-center">
            <a class="btn btn-success text-white" asp-action="AdminCreate">Create Account</a>
            <a class="btn btn-danger text-white ml-2" asp-action="AdminIndex">Back</a>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered text-dark">
                <thead>
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.AccountId)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Username)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.FullName)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Email)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.IsBlocked)
                    </th>
                </tr>
                </thead>
                <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.AccountId)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Username)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.FullName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Email)
                        </td>
                        <td class="isBlocked">
                            @if (item.Role == "Admin")
                            {
                                <select asp-for="@item.IsBlocked" class="form-control" disabled>
                                    @if (item.IsBlocked)
                                    {
                                        <option selected>False</option>
                                    }
                                    else
                                    {
                                        <option selected>True</option>
                                    }
                                </select>
                            }
                            else
                            {
                                <select asp-for="@item.IsBlocked" class="form-control account-@item.AccountId" onchange="changeBlocked(this)">
                                    @if (item.IsBlocked)
                                    {
                                        <option selected value="False">False</option>
                                        <option value="True">True</option>
                                    }
                                    else
                                    {
                                        <option selected value="True">True</option>
                                        <option value="False">False</option>
                                    }
                                </select>
                            }
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>


@section Scripts {


    <script>
        const changeBlocked = (elem) => {
            // Take the second class contains account ID, change the format "account-x" to "x"
            let accountId = elem.classList.item(1).split("-")[1]
            // Take role from select list
            let blocked = elem.value


            let apiUrl = "https://evergreen-api.onrender.com/api/User/ManageBlocked"

            let formData = {
                "accountId": accountId,
                "blocked": blocked
            }

            $.ajax({
                contentType: "application/json",
                processData: false,
                type: 'PUT',
                url: apiUrl,
                data: JSON.stringify(formData),
                error: function (xhr, status, error) {
                    console.log(error)
                }
            });

        }
    </script>
}